<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAD Jovice - Gemer</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root { --primary: #FFD700; --secondary: #004a99; --bg: #e9ecef; --card: #ffffff; --text: #212529; }
        body { font-family: 'Segoe UI', Roboto, sans-serif; background-color: var(--bg); margin: 0; padding: 15px; color: var(--text); }
        
        /* P√¥vodn√° Hlaviƒçka */
        .header { background: var(--secondary); color: white; padding: 25px 15px; border-radius: 0 0 20px 20px; text-align: center; margin: -15px -15px 20px -15px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
        .header h1 { margin: 0; font-size: 28px; }
        .header p { margin: 5px 0 0; font-style: italic; font-size: 14px; }

        /* Oznam z dispeƒçingu */
        #dispecing-oznam { background: var(--primary); color: black; padding: 10px; border-radius: 8px; margin-top: 15px; text-align: center; font-weight: bold; display: none; border: 2px solid #333; }

        /* Vyhƒæad√°vanie - P√¥vodn√Ω ≈°t√Ωl */
        .search-box { background: var(--card); padding: 15px; border-radius: 12px; margin-top: 20px; margin-bottom: 20px; position: relative; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        input, select, textarea { width: 100%; padding: 12px; margin: 5px 0; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
        .autocomplete-items { position: absolute; border: 1px solid #d4d4d4; background: white; z-index: 99; width: calc(100% - 30px); border-radius: 0 0 8px 8px; max-height: 200px; overflow-y: auto; }
        .autocomplete-items div { padding: 10px; cursor: pointer; border-bottom: 1px solid #eee; }
        .autocomplete-items div:hover { background-color: #e9e9e9; }

        /* Karty spojov - P√¥vodn√Ω ≈°t√Ωl */
        .bus-card { background: var(--card); border-radius: 12px; margin-bottom: 15px; overflow: hidden; box-shadow: 0 3px 6px rgba(0,0,0,0.1); border: 1px solid #ddd; cursor: pointer; }
        .bus-summary { padding: 15px; display: flex; justify-content: space-between; align-items: center; }
        .line-badge { background: var(--secondary); color: white; min-width: 70px; height: 35px; display: flex; align-items: center; justify-content: center; border-radius: 6px; font-weight: bold; font-size: 13px; }
        
        .bus-details { max-height: 0; overflow: hidden; transition: max-height 0.4s ease-out; background: #fdfdfd; border-top: 1px dashed #ccc; }
        .bus-card.active .bus-details { max-height: 1500px; }
        
        /* Zast√°vky s ƒçiaroƒçkou - P√¥vodn√Ω ≈°t√Ωl */
        .stations-list { padding: 15px; list-style: none; margin: 0; }
        .station-item { display: flex; gap: 15px; margin-bottom: 8px; position: relative; font-size: 14px; }
        .station-item::before { content: ''; width: 2px; background: #ddd; position: absolute; left: 44px; top: 15px; bottom: -15px; }
        .station-item:last-child::before { display: none; }
        .time { font-weight: bold; color: var(--secondary); min-width: 45px; z-index: 1; }

        .bus-footer { padding: 12px; background: #f1f1f1; font-size: 12px; display: flex; justify-content: space-between; align-items: center; }
        .spz-tag { background: white; padding: 4px 10px; border: 2px solid #333; border-radius: 5px; font-family: monospace; font-weight: bold; }

        /* MAPA */
        #map-container { background: var(--card); padding: 10px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border: 1px solid #ddd; display: none; }
        #map { height: 400px; width: 100%; border-radius: 8px; }

        /* Admin / Dispeƒçing */
        .admin-panel { background: #333; color: white; padding: 20px; border-radius: 12px; margin-top: 30px; }
        .btn { background: var(--primary); border: none; padding: 12px; border-radius: 8px; font-weight: bold; width: 100%; cursor: pointer; margin-top: 10px; font-size: 16px; }
        .btn-secondary { background: var(--secondary); color: white; }
    </style>
</head>
<body>

    <div class="header">
        <h1>SAD JOVICE</h1>
        <p>"V√°≈° dopravn√Ω sprievodca Gemerom"</p>
        <div id="dispecing-oznam"></div>
    </div>

    <div class="search-box">
        <input type="text" id="searchInput" onkeyup="searchStation()" placeholder="Kam cestujete? (napr. Lipovn√≠k)">
        <div id="autocomplete-list" class="autocomplete-items"></div>
        <button class="btn" onclick="alert('Vyhƒæad√°vam voƒæn√© bicykle...')">VYHƒΩADA≈§ SPOJENIE</button>
        <button class="btn btn-secondary" onclick="toggleMap()">ZOBRAZI≈§ MAPU TR√ÅS</button>
    </div>

    <div id="map-container">
        <h3 style="margin-top:0;">Mapa SAD Jovice</h3>
        <div id="map"></div>
    </div>

    <div id="links-container">
        </div>

    <div class="admin-panel">
        <strong>üîß DISPEƒåING A NASTAVENIA</strong><br>
        <small>Text oznamu pre cestuj√∫cich:</small>
        <textarea id="adminNote" placeholder="Napr. Me≈°kanie 25 min kv√¥li poƒçasiu..."></textarea>
        
        <small>Priradi≈• ≈†PZ k linke:</small>
        <select id="lineSelect"></select>
        <input type="text" id="newSpz" placeholder="Napr. RV-BIKE-01">
        
        <button class="btn" onclick="updateApp()">AKTUALIZOVA≈§ GRAFIKON</button>
        <button class="btn" style="background:#28a745; color:white; margin-top:20px;" onclick="generateShareLink()">üì§ ZDIEƒΩA≈§ STAV KAMAR√ÅTOVI</button>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // --- DATA (Vr√°tane tvojich nov√Ωch liniek) ---
        const zastavkyFull = [
            "Jovice, aut. stanica", "Jovice, Jednota", "Jovice, r√°zc. Krh. Dlh√° L√∫ka", 
            "Pole, ƒç. 1", "Pole, ƒç. 2", "Kr√°snohorsk√° Dlh√° L√∫ka, r√°zc. Jovice", 
            "Kr√°snohorsk√° Dlh√° L√∫ka, Jednota", "Kr√°snohorsk√° Dlh√° L√∫ka, most", 
            "Kr√°snohorsk√° Dlh√° L√∫ka, cintor√≠n", "Lipovn√≠k, z√°kruta", "Lipovn√≠k, ≈æel. most", 
            "Lipovn√≠k, ≈æelezniƒçn√° stanica", "Lipovn√≠k, ƒç. d. 1", "Lipovn√≠k, obch√°dzka", "Lipovn√≠k, Jednota"
        ];
        
        const casyOdStanice = [0, 1, 2, 3, 5, 7, 8, 9, 10, 13, 15, 20, 23, 25, 27];

        const spoje = [
            { id: "1", cislo: "808425", smer: "Jovice ‚ûî Lipovn√≠k", start: "15:00", trasa: zastavkyFull, min: casyOdStanice },
            { id: "2", cislo: "808425", smer: "Lipovn√≠k ‚ûî Jovice", start: "15:35", trasa: [...zastavkyFull].reverse(), min: casyOdStanice },
            { id: "3", cislo: "808425", smer: "Jovice ‚ûî Lipovn√≠k", start: "15:20", trasa: zastavkyFull, min: casyOdStanice },
            { id: "4", cislo: "808425", smer: "Jovice ‚ûî Lipovn√≠k", start: "15:40", trasa: zastavkyFull, min: casyOdStanice },
            { id: "5", cislo: "808423", smer: "Jovice ‚ûî Kr√°snohorsk√° Dlh√° L√∫ka", start: "15:20", trasa: zastavkyFull.slice(0, 7), min: casyOdStanice.slice(0, 7) },
            { id: "6", cislo: "808423", smer: "Kr√°snohorsk√° Dlh√° L√∫ka ‚ûî Jovice", start: "15:40", trasa: zastavkyFull.slice(0, 7).reverse(), min: casyOdStanice.slice(0, 7) },
            { id: "7", cislo: "808427", smer: "Kr√°snohorsk√° Dlh√° L√∫ka ‚ûî Lipovn√≠k", start: "15:10", trasa: zastavkyFull.slice(6), min: [0, 1, 2, 3, 6, 8, 13, 16, 18, 20] },
            { id: "8", cislo: "808423", smer: "Jovice ‚ûî Kr√°snohorsk√° Dlh√° L√∫ka", start: "16:00", trasa: zastavkyFull.slice(0, 7), min: casyOdStanice.slice(0, 7) },
            { id: "9", cislo: "808423", smer: "Kr√°snohorsk√° Dlh√° L√∫ka ‚ûî Jovice", start: "16:10", trasa: zastavkyFull.slice(0, 7).reverse(), min: casyOdStanice.slice(0, 7) }
        ];

        // --- FUNKCIE ---
        function pridajCas(start, plusMinuty) {
            let [h, m] = start.split(':').map(Number);
            let d = new Date(); d.setHours(h); d.setMinutes(m + plusMinuty);
            return d.getHours().toString().padStart(2, '0') + ":" + d.getMinutes().toString().padStart(2, '0');
        }

        function vykresliLinky() {
            const container = document.getElementById('links-container');
            const select = document.getElementById('lineSelect');
            container.innerHTML = "";
            
            spoje.forEach(spoj => {
                let card = document.createElement('div');
                card.className = 'bus-card';
                card.onclick = function() { this.classList.toggle('active'); };
                
                let html = `
                    <div class="bus-summary">
                        <div style="display:flex; align-items:center; gap:12px;">
                            <div class="line-badge">${spoj.cislo}</div>
                            <div><strong>${spoj.smer}</strong><br><small>Odchod: ${spoj.start}</small></div>
                        </div>
                        <span>‚ñº</span>
                    </div>
                    <div class="bus-details">
                        <div class="stations-list">`;
                
                spoj.trasa.forEach((z, i) => {
                    html += `
                        <div class="station-item">
                            <span class="time">${pridajCas(spoj.start, spoj.min[i])}</span>
                            <span>${z}</span>
                        </div>`;
                });

                html += `
                        </div>
                        <div class="bus-footer">
                            <span>Dopravca: <strong>SAD Jovice</strong></span>
                            <span class="spz-tag" id="tag-${spoj.id}">RV-JOVICE</span>
                        </div>
                    </div>`;
                
                card.innerHTML = html;
                container.appendChild(card);

                let opt = document.createElement('option');
                opt.value = spoj.id;
                opt.innerText = `${spoj.cislo} (${spoj.start})`;
                select.appendChild(opt);
            });
        }

        // --- MAPA ---
        let leafletMap;
        function toggleMap() {
            const mapDiv = document.getElementById('map-container');
            if (mapDiv.style.display === 'block') {
                mapDiv.style.display = 'none';
            } else {
                mapDiv.style.display = 'block';
                if (!leafletMap) {
                    leafletMap = L.map('map').setView([48.628, 20.585], 13);
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(leafletMap);
                    
                    const p_jovice = [48.6369, 20.5564];
                    const p_luka = [48.6186, 20.5786];
                    const p_lipovnik = [48.6342, 20.6183];

                    L.marker(p_jovice).addTo(leafletMap).bindPopup("Jovice");
                    L.marker(p_luka).addTo(leafletMap).bindPopup("Krh. Dlh√° L√∫ka");
                    L.marker(p_lipovnik).addTo(leafletMap).bindPopup("Lipovn√≠k");

                    L.polyline([p_jovice, p_luka, p_lipovnik], {color: 'blue', weight: 4}).addTo(leafletMap);
                }
            }
        }

        // --- DISPEƒåING ---
        function updateApp() {
            const note = document.getElementById('adminNote').value;
            const spz = document.getElementById('newSpz').value;
            const id = document.getElementById('lineSelect').value;
            
            if (note) {
                const oznam = document.getElementById('dispecing-oznam');
                oznam.innerText = "‚ö†Ô∏è " + note;
                oznam.style.display = "block";
            }
            if (spz) {
                document.getElementById('tag-' + id).innerText = spz;
            }
            alert("Zmeny boli aplikovan√©!");
        }

        function generateShareLink() {
            const note = encodeURIComponent(document.getElementById('adminNote').value);
            const spz = encodeURIComponent(document.getElementById('newSpz').value);
            const id = document.getElementById('lineSelect').value;
            const url = window.location.origin + window.location.pathname + `?note=${note}&spz=${spz}&id=${id}`;
            navigator.clipboard.writeText(url);
            alert("Link na aktu√°lny stav dispeƒçingu bol skop√≠rovan√Ω! Po≈°li ho kamar√°tovi.");
        }

        function loadFromParams() {
            const params = new URLSearchParams(window.location.search);
            if (params.has('note')) {
                const oznam = document.getElementById('dispecing-oznam');
                oznam.innerText = "‚ö†Ô∏è " + decodeURIComponent(params.get('note'));
                oznam.style.display = "block";
            }
            if (params.has('spz') && params.has('id')) {
                setTimeout(() => {
                    const tag = document.getElementById('tag-' + params.get('id'));
                    if (tag) tag.innerText = decodeURIComponent(params.get('spz'));
                }, 500);
            }
        }

        function searchStation() {
            let input = document.getElementById("searchInput").value.toLowerCase();
            let list = document.getElementById("autocomplete-list");
            list.innerHTML = "";
            if (!input) return;
            [...new Set(zastavkyFull)].forEach(z => {
                if (z.toLowerCase().includes(input)) {
                    let div = document.createElement("div");
                    div.innerText = z;
                    div.onclick = function() {
                        document.getElementById("searchInput").value = z;
                        list.innerHTML = "";
                    };
                    list.appendChild(div);
                }
            });
        }

        vykresliLinky();
        loadFromParams();
    </script>
</body>
</html>
