<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAD Jovice</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root { --primary: #FFD700; --secondary: #004a99; --bg: #e9ecef; --card: #ffffff; --text: #212529; }
        body { font-family: 'Segoe UI', sans-serif; background-color: var(--bg); margin: 0; padding: 0; padding-bottom: 70px; color: var(--text); overflow-x: hidden; }
        
        /* Dispeƒçersk√Ω oznam */
        #alert-bar { background: var(--primary); color: #000; padding: 10px; text-align: center; font-weight: bold; font-size: 14px; display: none; border-bottom: 2px solid #000; }

        .header { background: var(--secondary); color: white; padding: 20px 15px; text-align: center; box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
        
        .page { display: none; padding: 15px; animation: fadeIn 0.3s ease; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Vyhƒæad√°vanie a Karty */
        .search-box { background: var(--card); padding: 15px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        input, select, textarea { width: 100%; padding: 12px; margin: 5px 0; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
        
        .bus-card { background: var(--card); border-radius: 12px; margin-bottom: 15px; border: 1px solid #ddd; overflow: hidden; }
        .bus-summary { padding: 15px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; }
        .line-badge { background: var(--secondary); color: white; padding: 5px 10px; border-radius: 6px; font-weight: bold; }
        
        .bus-details { display: none; padding: 15px; background: #fdfdfd; border-top: 1px dashed #ccc; }
        .station-item { display: flex; gap: 15px; margin-bottom: 8px; font-size: 14px; }
        .time { font-weight: bold; color: var(--secondary); }

        /* Mapa */
        #map { height: 70vh; width: 100%; border-radius: 12px; border: 2px solid var(--secondary); }

        /* Navig√°cia */
        .nav-bar { position: fixed; bottom: 0; width: 100%; background: white; display: flex; justify-content: space-around; padding: 10px 0; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); z-index: 1000; }
        .nav-item { border: none; background: none; font-size: 12px; color: #666; cursor: pointer; display: flex; flex-direction: column; align-items: center; }
        .nav-item.active { color: var(--secondary); font-weight: bold; }
        .nav-icon { font-size: 20px; margin-bottom: 3px; }

        .btn { background: var(--primary); border: none; padding: 12px; border-radius: 8px; font-weight: bold; width: 100%; cursor: pointer; margin-top: 10px; }
        .btn-map { background: var(--secondary); color: white; padding: 5px 10px; border-radius: 5px; font-size: 12px; margin-top: 5px; display: inline-block; text-decoration: none; }
    </style>
</head>
<body>

    <div id="alert-bar">‚ö†Ô∏è OZNAM: Prem√°vka bez obmedzen√≠.</div>

    <div class="header">
        <h1>SAD JOVICE</h1>
    </div>

    <div id="page-list" class="page active">
        <div class="search-box">
            <input type="text" id="searchInput" onkeyup="search()" placeholder="Kam cestujete?">
        </div>
        <div id="links-container"></div>
    </div>

    <div id="page-map" class="page">
        <h3 style="margin-top:0;">Mapa tr√°s SAD Jovice</h3>
        <div id="map"></div>
        <p><small>Linky: Modr√° (808425), ƒåerven√° (808423), Zelen√° (808427)</small></p>
    </div>

    <div id="page-admin" class="page">
        <div class="search-box">
            <h3>üîß Dispeƒçing</h3>
            <label>Text oznamu (hore):</label>
            <textarea id="adminNote" rows="2" placeholder="Napr. Me≈°kanie 25 min kv√¥li poƒçasiu..."></textarea>
            
            <label style="margin-top:10px; display:block;">Priradi≈• ≈†PZ k linke:</label>
            <select id="lineSelect"></select>
            <input type="text" id="newSpz" placeholder="Napr. RV-BIKE-01">
            
            <button class="btn" onclick="applyChanges()">AKTUALIZOVA≈§ APLIK√ÅCIU</button>
            <hr>
            <button class="btn" style="background:#28a745; color:white;" onclick="generateShareLink()">üì§ ZDIEƒΩA≈§ STAV KAMAR√ÅTOVI</button>
            <p><small>Tlaƒçidlo vygeneruje odkaz, ktor√Ω po≈°le≈° kamar√°tovi, aby videl tvoje zmeny.</small></p>
        </div>
    </div>

    <div class="nav-bar">
        <button class="nav-item active" onclick="showPage('page-list', this)">
            <span class="nav-icon">üïí</span>Spoje
        </button>
        <button class="nav-item" onclick="showPage('page-map', this)">
            <span class="nav-icon">üó∫Ô∏è</span>Mapa
        </button>
        <button class="nav-item" onclick="showPage('page-admin', this)">
            <span class="nav-icon">‚öôÔ∏è</span>Dispeƒçing
        </button>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        const zastavkyFull = ["Jovice, aut. stanica", "Jovice, Jednota", "Jovice, r√°zc. Krh. Dlh√° L√∫ka", "Pole, ƒç. 1", "Pole, ƒç. 2", "Kr√°snohorsk√° Dlh√° L√∫ka, r√°zc. Jovice", "Kr√°snohorsk√° Dlh√° L√∫ka, Jednota", "Kr√°snohorsk√° Dlh√° L√∫ka, most", "Kr√°snohorsk√° Dlh√° L√∫ka, cintor√≠n", "Lipovn√≠k, z√°kruta", "Lipovn√≠k, ≈æel. most", "Lipovn√≠k, ≈æelezniƒçn√° stanica", "Lipovn√≠k, ƒç. d. 1", "Lipovn√≠k, obch√°dzka", "Lipovn√≠k, Jednota"];
        const casyOdStanice = [0, 1, 2, 3, 5, 7, 8, 9, 10, 13, 15, 20, 23, 25, 27];

        const spoje = [
            { id: "1", cislo: "808425", smer: "Jovice ‚ûî Lipovn√≠k", start: "15:00", trasa: zastavkyFull, min: casyOdStanice, color: 'blue' },
            { id: "2", cislo: "808425", smer: "Lipovn√≠k ‚ûî Jovice", start: "15:35", trasa: [...zastavkyFull].reverse(), min: casyOdStanice, color: 'blue' },
            { id: "3", cislo: "808425", smer: "Jovice ‚ûî Lipovn√≠k", start: "15:20", trasa: zastavkyFull, min: casyOdStanice, color: 'blue' },
            { id: "4", cislo: "808425", smer: "Jovice ‚ûî Lipovn√≠k", start: "15:40", trasa: zastavkyFull, min: casyOdStanice, color: 'blue' },
            { id: "5", cislo: "808423", smer: "Jovice ‚ûî K. D. L√∫ka", start: "15:20", trasa: zastavkyFull.slice(0, 7), min: casyOdStanice.slice(0, 7), color: 'red' },
            { id: "6", cislo: "808423", smer: "K. D. L√∫ka ‚ûî Jovice", start: "15:40", trasa: zastavkyFull.slice(0, 7).reverse(), min: casyOdStanice.slice(0, 7), color: 'red' },
            { id: "7", cislo: "808427", smer: "K. D. L√∫ka ‚ûî Lipovn√≠k", start: "15:10", trasa: zastavkyFull.slice(6), min: [0, 1, 2, 3, 6, 8, 13, 16, 18, 20], color: 'green' },
            { id: "8", cislo: "808423", smer: "Jovice ‚ûî K. D. L√∫ka", start: "16:00", trasa: zastavkyFull.slice(0, 7), min: casyOdStanice.slice(0, 7), color: 'red' },
            { id: "9", cislo: "808423", smer: "K. D. L√∫ka ‚ûî Jovice", start: "16:10", trasa: zastavkyFull.slice(0, 7).reverse(), min: casyOdStanice.slice(0, 7), color: 'red' }
        ];

        // Koordin√°ty obc√≠ pre mapu
        const coords = {
            "Jovice": [48.6369, 20.5564],
            "K. D. L√∫ka": [48.6186, 20.5786],
            "Lipovn√≠k": [48.6342, 20.6183]
        };

        let map, mapLoaded = false;

        function pridajCas(start, plusMinuty) {
            let [h, m] = start.split(':').map(Number);
            let d = new Date(); d.setHours(h); d.setMinutes(m + plusMinuty);
            return d.getHours().toString().padStart(2, '0') + ":" + d.getMinutes().toString().padStart(2, '0');
        }

        function showPage(pageId, btn) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            btn.classList.add('active');
            if(pageId === 'page-map' && !mapLoaded) initMap();
        }

        function initMap() {
            map = L.map('map').setView([48.625, 20.58], 13);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
            
            // Markery
            L.marker(coords["Jovice"]).addTo(map).bindPopup("Jovice");
            L.marker(coords["K. D. L√∫ka"]).addTo(map).bindPopup("Krh. Dlh√° L√∫ka");
            L.marker(coords["Lipovn√≠k"]).addTo(map).bindPopup("Lipovn√≠k");

            // Trasy (ƒçiary)
            L.polyline([coords["Jovice"], coords["K. D. L√∫ka"], coords["Lipovn√≠k"]], {color: 'blue', weight: 5}).addTo(map); // 808425
            L.polyline([coords["Jovice"], coords["K. D. L√∫ka"]], {color: 'red', weight: 3}).addTo(map); // 808423
            L.polyline([coords["K. D. L√∫ka"], coords["Lipovn√≠k"]], {color: 'green', weight: 3}).addTo(map); // 808427
            
            mapLoaded = true;
        }

        function vykresliLinky() {
            const container = document.getElementById('links-container');
            const select = document.getElementById('lineSelect');
            container.innerHTML = "";
            
            spoje.forEach(spoj => {
                let card = document.createElement('div');
                card.className = 'bus-card';
                card.innerHTML = `
                    <div class="bus-summary" onclick="toggleDetails(this)">
                        <div>
                            <span class="line-badge">${spoj.cislo}</span>
                            <strong>${spoj.smer}</strong><br>
                            <small>Odchod: ${spoj.start} | <span id="spz-${spoj.id}">RV-JOVICE</span></small>
                        </div>
                        <span>‚ñº</span>
                    </div>
                    <div class="bus-details">
                        <div class="stations-list">
                            ${spoj.trasa.map((z, i) => `
                                <div class="station-item">
                                    <span class="time">${pridajCas(spoj.start, spoj.min[i])}</span>
                                    <span>${z}</span>
                                </div>`).join('')}
                        </div>
                        <center><a href="#" class="btn-map" onclick="showPage('page-map', document.querySelectorAll('.nav-item')[1])">Zobrazi≈• na mape</a></center>
                    </div>`;
                container.appendChild(card);
                let opt = document.createElement('option'); opt.value = spoj.id; opt.innerText = `${spoj.cislo} (${spoj.start})`;
                select.appendChild(opt);
            });
        }

        function toggleDetails(el) {
            const details = el.nextElementSibling;
            details.style.display = details.style.display === 'block' ? 'none' : 'block';
        }

        function applyChanges() {
            const note = document.getElementById('adminNote').value;
            const spz = document.getElementById('newSpz').value;
            const lineId = document.getElementById('lineSelect').value;
            
            if(note) {
                const bar = document.getElementById('alert-bar');
                bar.innerText = "‚ö†Ô∏è " + note;
                bar.style.display = 'block';
            }
            if(spz) {
                document.getElementById('spz-' + lineId).innerText = spz;
            }
            alert("Zmeny boli aplikovan√© lok√°lne!");
        }

        // --- ZDIEƒΩACIA LOGIKA ---
        function generateShareLink() {
            const note = encodeURIComponent(document.getElementById('adminNote').value);
            const spz = encodeURIComponent(document.getElementById('newSpz').value);
            const lineId = document.getElementById('lineSelect').value;
            
            const shareUrl = window.location.origin + window.location.pathname + `?note=${note}&spz=${spz}&id=${lineId}`;
            
            navigator.clipboard.writeText(shareUrl);
            alert("Odkaz bol skop√≠rovan√Ω! Po≈°li ho kamar√°tovi. Keƒè na≈à klikne, uvid√≠ tvoje nastavenia.");
        }

        // Naƒç√≠tanie d√°t z odkazu (ak nejak√Ω pri≈°iel)
        function checkParams() {
            const params = new URLSearchParams(window.location.search);
            if(params.has('note')) {
                const bar = document.getElementById('alert-bar');
                bar.innerText = "‚ö†Ô∏è " + decodeURIComponent(params.get('note'));
                bar.style.display = 'block';
            }
            if(params.has('spz') && params.has('id')) {
                setTimeout(() => {
                    const el = document.getElementById('spz-' + params.get('id'));
                    if(el) el.innerText = decodeURIComponent(params.get('spz'));
                }, 500);
            }
        }

        function search() {
            let input = document.getElementById('searchInput').value.toLowerCase();
            document.querySelectorAll('.bus-card').forEach(card => {
                card.style.display = card.innerText.toLowerCase().includes(input) ? "block" : "none";
            });
        }

        vykresliLinky();
        checkParams();
    </script>
</body>
</html>
