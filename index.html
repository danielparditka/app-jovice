<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAD Jovice</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root { --primary: #FFD700; --secondary: #004a99; --bg: #e9ecef; --card: #ffffff; --text: #212529; --success: #28a745; --danger: #dc3545; }
        body { font-family: 'Segoe UI', Roboto, sans-serif; background-color: var(--bg); margin: 0; padding: 15px; color: var(--text); }
        
        /* BOD 1: Hlaviƒçka s logom na bielom pozad√≠ */
        .header { background: var(--secondary); color: white; padding: 20px 15px; border-radius: 0 0 20px 20px; text-align: center; margin: -15px -15px 20px -15px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
        .logo-container { background: white; display: inline-block; padding: 10px 20px; border-radius: 12px; margin-bottom: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .logo-text { font-size: 24px; font-weight: bold; color: var(--secondary); display: flex; align-items: center; gap: 8px; }
        .logo-symbol { color: #dc3545; font-size: 28px; }
        .header p { margin: 5px 0 0; font-style: italic; font-size: 14px; opacity: 0.9; }

        #dispecing-oznam { background: var(--primary); color: black; padding: 10px; border-radius: 8px; margin-top: 15px; text-align: center; font-weight: bold; display: none; border: 2px solid #333; }
        .search-box { background: var(--card); padding: 15px; border-radius: 12px; margin-top: 20px; margin-bottom: 20px; position: relative; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        input, select, textarea { width: 100%; padding: 12px; margin: 5px 0; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
        
        .bus-card { background: var(--card); border-radius: 12px; margin-bottom: 15px; overflow: hidden; box-shadow: 0 3px 6px rgba(0,0,0,0.1); border: 1px solid #ddd; cursor: pointer; }
        .bus-summary { padding: 15px; display: flex; justify-content: space-between; align-items: center; }
        .line-badge { background: var(--secondary); color: white; min-width: 70px; height: 35px; display: flex; align-items: center; justify-content: center; border-radius: 6px; font-weight: bold; font-size: 13px; }
        
        /* BOD 2 & 3: Ikonky a stav spoja */
        .bus-meta { display: flex; align-items: center; gap: 10px; margin-top: 5px; font-size: 14px; }
        .status-tag { font-weight: bold; padding: 2px 6px; border-radius: 4px; font-size: 11px; text-transform: uppercase; }
        .status-ontime { background: #e8f5e9; color: var(--success); }
        .status-delayed { background: #ffebee; color: var(--danger); }
        .amenities { color: #666; font-size: 16px; }

        .bus-details { max-height: 0; overflow: hidden; transition: max-height 0.4s ease-out; background: #fdfdfd; border-top: 1px dashed #ccc; }
        .bus-card.active .bus-details { max-height: 1500px; }
        .stations-list { padding: 15px; list-style: none; margin: 0; }
        .station-item { display: flex; gap: 15px; margin-bottom: 8px; position: relative; font-size: 14px; }
        .station-item::before { content: ''; width: 2px; background: #ddd; position: absolute; left: 44px; top: 15px; bottom: -15px; }
        .station-item:last-child::before { display: none; }
        .time { font-weight: bold; color: var(--secondary); min-width: 45px; z-index: 1; }
        
        .spz-tag { background: white; padding: 4px 10px; border: 2px solid #333; border-radius: 5px; font-family: monospace; font-weight: bold; }
        #map-container { background: var(--card); padding: 10px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border: 1px solid #ddd; display: none; }
        #map { height: 400px; width: 100%; border-radius: 8px; }
        
        .admin-panel { background: #333; color: white; padding: 20px; border-radius: 12px; margin-top: 30px; }
        .btn { background: var(--primary); border: none; padding: 12px; border-radius: 8px; font-weight: bold; width: 100%; cursor: pointer; margin-top: 10px; font-size: 16px; }
        .btn-secondary { background: var(--secondary); color: white; }
    </style>
</head>
<body>

    <div class="header">
        <div class="logo-container">
            <div class="logo-text"><span class="logo-symbol">S</span>AD JOVICE</div>
        </div>
        <p>"V√°≈° dopravn√Ω sprievodca Gemerom"</p>
        <div id="dispecing-oznam"></div>
    </div>

    <div class="search-box">
        <input type="text" id="searchInput" onkeyup="showAutocomplete()" placeholder="Kam cestujete?" autocomplete="off">
        <div id="autocomplete-list" class="autocomplete-items"></div>
        <div style="display: flex; gap: 10px; margin-top: 5px;">
            <input type="time" id="timeInput">
            <button class="btn" style="margin-top:0; width: auto; padding: 8px 12px;" onclick="clearTime()">ZRU≈†I≈§</button>
        </div>
        <button class="btn" onclick="executeSearch()">VYHƒΩADA≈§ SPOJENIE</button>
        <button class="btn btn-secondary" onclick="toggleMap()">ZOBRAZI≈§ MAPU TR√ÅS</button>
    </div>

    <div id="map-container">
        <h3 style="margin-top:0;">Mapa SAD Jovice</h3>
        <div id="map"></div>
    </div>

    <div id="links-container"></div>

    <div class="admin-panel">
        <strong>üîß DISPEƒåING REAL-TIME</strong><br>
        <small>Zmeni≈• stav linky:</small>
        <select id="statusLineSelect"></select>
        <select id="statusValueSelect">
            <option value="ontime">NAƒåAS</option>
            <option value="delayed">ME≈†KANIE</option>
            <option value="canceled">ZRU≈†EN√â</option>
        </select>
        <button class="btn" onclick="updateLiveStatus()">AKTUALIZOVA≈§ STAV</button>
        <hr style="margin: 20px 0; border: 0; border-top: 1px solid #555;">
        <small>Text oznamu:</small>
        <textarea id="adminNote" placeholder="Oznam pre cestuj√∫cich..."></textarea>
        <button class="btn" onclick="updateApp()">PUBLIKOVA≈§ OZNAM</button>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        const zastavkyJoviceLipovnik = [
            "Jovice, aut. stanica", "Jovice, Hradn√° ul., most", "Jovice, Hradn√° ul., odboƒçka", "Jovice, futbalov√© ihrisko", 
            "Pole, ƒç. 1", "Pole, ƒç. 2", "Kr√°snohorsk√° Dlh√° L√∫ka, z√°pad", "Kr√°snohorsk√° Dlh√° L√∫ka, kr√≠≈æ",
            "Kr√°snohorsk√° Dlh√° L√∫ka, Jednota", "Kr√°snohorsk√° Dlh√° L√∫ka, most", "Kr√°snohorsk√° Dlh√° L√∫ka, cintor√≠n", 
            "Lipovn√≠k, z√°kruta", "Lipovn√≠k, ≈æel. most", "Lipovn√≠k, ≈æelezniƒçn√° stanica", "Lipovn√≠k, ƒç. d. 1", "Lipovn√≠k, obch√°dzka", "Lipovn√≠k, Jednota"
        ];
        
        const casyJoviceLipovnik = [0, 1, 2, 3, 4, 6, 8, 9, 10, 11, 12, 15, 17, 22, 25, 27, 29];
        const zastavkyLipovnikJovice = [...zastavkyJoviceLipovnik].reverse();
        const casyLipovnikJovice = [0, 2, 4, 7, 12, 14, 17, 18, 19, 20, 21, 23, 25, 26, 27, 28, 29];

        const spoje = [
            { id: "1", cislo: "808425", smer: "Jovice ‚ûî Lipovn√≠k", start: "15:00", trasa: zastavkyJoviceLipovnik, min: casyJoviceLipovnik },
            { id: "2", cislo: "808425", smer: "Lipovn√≠k ‚ûî Jovice", start: "15:35", trasa: zastavkyLipovnikJovice, min: casyLipovnikJovice },
            { id: "3", cislo: "808425", smer: "Jovice ‚ûî Lipovn√≠k", start: "15:20", trasa: zastavkyJoviceLipovnik, min: casyJoviceLipovnik },
            { id: "4", cislo: "808425", smer: "Jovice ‚ûî Lipovn√≠k", start: "15:40", trasa: zastavkyJoviceLipovnik, min: casyJoviceLipovnik },
            { id: "Spiat_1", cislo: "808425", smer: "Lipovn√≠k ‚ûî Jovice", start: "15:55", trasa: zastavkyLipovnikJovice, min: casyLipovnikJovice },
            { id: "Spiat_2", cislo: "808425", smer: "Lipovn√≠k ‚ûî Jovice", start: "16:15", trasa: zastavkyLipovnikJovice, min: casyLipovnikJovice },
            { id: "5", cislo: "808423", smer: "Jovice ‚ûî Kr√°snohorsk√° Dlh√° L√∫ka", start: "15:20", trasa: zastavkyJoviceLipovnik.slice(0, 9), min: casyJoviceLipovnik.slice(0, 9) },
            { id: "6", cislo: "808423", smer: "Kr√°snohorsk√° Dlh√° L√∫ka ‚ûî Jovice", start: "15:40", trasa: zastavkyJoviceLipovnik.slice(0, 9).reverse(), min: [0, 1, 2, 3, 5, 6, 7, 8, 9] },
            { id: "S1", cislo: "1", smer: "Jovice, Jednota ‚ûî Jovice, matersk√° ≈°k√¥lka", start: "15:51", trasa: ["Jovice, Jednota", "Jovice, aut. stanica", "Jovice, matersk√° ≈°k√¥lka"], min: [0, 1, 2] },
            { id: "S2", cislo: "1", smer: "Jovice, matersk√° ≈°k√¥lka ‚ûî Jovice, Jednota", start: "15:59", trasa: ["Jovice, matersk√° ≈°k√¥lka", "Jovice, Jednota"], min: [0, 1] },
            { id: "R1", cislo: "808426", smer: "Jovice ‚ûî Ro≈æ≈àava, AS", start: "15:00", trasa: ["Jovice, aut. stanica", "Jovice, ƒç.d. 25", "Jovice, rozvod≈àa", "Jovice, CWT Metal", "Brzot√≠n, Badinotti", "Ro≈æ≈àava, ≈æel. priecestie", "Ro≈æ≈àava, eurobus", "Ro≈æ≈àava, Kaufland", "Ro≈æ≈àava, √∫rad pr√°ce", "Ro≈æ≈àava, ≈†af√°rikova ulica", "Ro≈æ≈àava, AS"], min: [0, 1, 4, 6, 8, 10, 15, 17, 19, 21, 23] },
            { id: "L1", cislo: "808478", smer: "Jovice, Jednota ‚ûî Jovice, pod lesom", start: "12:00", trasa: ["Jovice, Jednota", "Jovice, stred", "Jovice, pod lesom"], min: [0, 1, 2] },
            { id: "L2", cislo: "808478", smer: "Jovice, pod lesom ‚ûî Jovice, Jednota", start: "12:03", trasa: ["Jovice, pod lesom", "Jovice, stred", "Jovice, Jednota"], min: [0, 1, 2] }
        ];

        function pridajCas(start, plusMinuty) {
            let [h, m] = start.split(':').map(Number);
            let d = new Date(); d.setHours(h); d.setMinutes(m + plusMinuty);
            return d.getHours().toString().padStart(2, '0') + ":" + d.getMinutes().toString().padStart(2, '0');
        }

        function vykresliLinky() {
            const container = document.getElementById('links-container');
            const select = document.getElementById('statusLineSelect');
            container.innerHTML = ""; select.innerHTML = "";
            spoje.forEach(spoj => {
                let card = document.createElement('div');
                card.className = 'bus-card';
                card.id = "card-" + spoj.id;
                card.onclick = function() { this.classList.toggle('active'); };
                card.innerHTML = `
                    <div class="bus-summary">
                        <div>
                            <div style="display:flex; align-items:center; gap:12px;">
                                <div class="line-badge">${spoj.cislo}</div>
                                <div><strong>${spoj.smer}</strong><br><small>Odchod: ${spoj.start}</small></div>
                            </div>
                            <div class="bus-meta">
                                <span class="status-tag status-ontime" id="status-${spoj.id}">NAƒåAS</span>
                                <span class="amenities">‚ôø üì∂</span>
                            </div>
                        </div>
                        <span>‚ñº</span>
                    </div>
                    <div class="bus-details">
                        <div class="stations-list">${spoj.trasa.map((z, i) => `<div class="station-item"><span class="time">${pridajCas(spoj.start, spoj.min[i])}</span><span>${z}</span></div>`).join('')}</div>
                        <div class="bus-footer" style="padding:10px; background:#eee; display:flex; justify-content:space-between; font-size:12px;">
                            <span>SAD JOVICE</span><span class="spz-tag">RV-JOVICE</span>
                        </div>
                    </div>`;
                container.appendChild(card);
                select.innerHTML += `<option value="${spoj.id}">${spoj.cislo} (${spoj.start})</option>`;
            });
        }

        function updateLiveStatus() {
            const id = document.getElementById('statusLineSelect').value;
            const val = document.getElementById('statusValueSelect').value;
            const tag = document.getElementById('status-' + id);
            tag.className = "status-tag " + (val === 'ontime' ? 'status-ontime' : 'status-delayed');
            tag.innerText = val === 'ontime' ? 'NAƒåAS' : (val === 'delayed' ? 'ME≈†KANIE' : 'ZRU≈†EN√â');
            alert("Stav spoja aktualizovan√Ω!");
        }

        function updateApp() {
            const note = document.getElementById('adminNote').value;
            const oznam = document.getElementById('dispecing-oznam');
            if (note) { oznam.innerText = "‚ö†Ô∏è " + note; oznam.style.display = "block"; }
            else { oznam.style.display = "none"; }
        }

        let leafletMap;
        function toggleMap() {
            const mapDiv = document.getElementById('map-container');
            mapDiv.style.display = mapDiv.style.display === 'block' ? 'none' : 'block';
            if (!leafletMap && mapDiv.style.display === 'block') {
                leafletMap = L.map('map').setView([48.628, 20.585], 13);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(leafletMap);
                const p_jovice = [48.6369, 20.5564], p_luka = [48.6186, 20.5786], p_lipovnik = [48.6342, 20.6183];
                L.marker(p_jovice).addTo(leafletMap).bindPopup("Jovice");
                L.marker(p_luka).addTo(leafletMap).bindPopup("Krh. Dlh√° L√∫ka");
                L.marker(p_lipovnik).addTo(leafletMap).bindPopup("Lipovn√≠k");
                L.polyline([p_jovice, p_luka], {color: 'red', weight: 5}).addTo(leafletMap);
                L.polyline([p_luka, p_lipovnik], {color: 'blue', weight: 5}).addTo(leafletMap);
            }
        }

        function showAutocomplete() {
            let input = document.getElementById("searchInput").value.toLowerCase();
            let list = document.getElementById("autocomplete-list");
            list.innerHTML = "";
            if (!input) return;
            [...new Set(spoje.flatMap(s => s.trasa))].forEach(z => {
                if (z.toLowerCase().includes(input)) {
                    let div = document.createElement("div");
                    div.innerText = z;
                    div.onclick = () => { document.getElementById("searchInput").value = z; list.innerHTML = ""; executeSearch(); };
                    list.appendChild(div);
                }
            });
        }

        function executeSearch() {
            let dest = document.getElementById("searchInput").value.toLowerCase();
            let time = document.getElementById("timeInput").value;
            document.querySelectorAll('.bus-card').forEach(card => {
                let s = spoje.find(sp => "card-"+sp.id === card.id);
                let mS = dest === "" || s.trasa.some(z => z.toLowerCase().includes(dest));
                let mT = time === "" || s.start >= time;
                card.style.display = (mS && mT) ? "block" : "none";
            });
        }

        function clearTime() { document.getElementById("timeInput").value = ""; executeSearch(); }

        vykresliLinky();
    </script>
</body>
</html>
